!function(t,e){"use strict";function n(t){function n(t,n,i){this.id=t.attr(i.nodeIdAttr),this.row=t,this.tree=n,this.children=[],this.initialized=!1,this.settings=i,this.parentId=this._getParentId(t,i.parentIdAttr),this.bgColor=null,this.treeCell=e(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=e(this.settings.expanderTemplate),this.reducer=e(this.settings.reducerTemplate),this.toggleBtn=e("<span></span>"),this.indenter=e(this.settings.indenterTemplate),this.treeCell.prepend(this.indenter)}function i(t){this.tree={},this.settings=t,this.selected={},this.nodes=[],this.roots=[]}function s(t){var n=t.children("table");return n.length?(n.children().remove(),n):(n=e("<table></table>"),n.addClass("table table-striped"),n.width("100%"),n)}function r(t,e){var n;for(n in e)t.append(e[n].row),e[n].children.length>0&&r(t,e[n].children)}function o(t,e){var n,i,s=t.tree,r=e.checked;if(void 0!==t.cacheChecked)for(n=t.cacheChecked.length,i=0;n>i;i++)void 0!==s[t.cacheChecked[i]]&&s[t.cacheChecked[i]].setUnChecke();for(n=e.checked.length,i=0;n>i;i++)void 0!==s[r[i]]&&s[r[i]].setChecked();t.cacheChecked=r}function d(t,n){t.ncOptions=e.extend({branchAttr:"ttBranch",clickableNodeNames:!0,column:1,columNames:["name"],withInput:{type:"radio",width:"20px",name:"radio"},selectedColor:"#2f75b2",columnElType:"td",expandable:!0,expanderTemplate:"<i>+</i>",reducerTemplate:"<i>-</i>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"nc-treetable-id",parentIdAttr:"nc-treetable-parent-id",stringExpand:"Expand",stringCollapse:"Collapse",selected:[],checked:[]},t.ncOptions),t.rendering=!1;var d=new i(t.ncOptions);d.loadRows(t.ncData).render(),o(d,t.ncOptions);var a=s(n);r(a,d.roots),t.$watch("ncData",function(e,n){e==n||t.rendering||(t.rendering=!0,d=new i(t.ncOptions),d.loadRows(t.ncData).render(),a.children().remove(),r(a,d.roots),t.rendering=!1)}),t.ncOptions.checked&&(t.ncOptions.selected=t.ncOptions.checked),t.$watch("ncOptions.checked",function(e,n){e!=n&&(t.ncOptions.selected=e,o(d,t.ncOptions))}),a.on("click",function(e){t.$apply(),e.stopPropagation()}),n.append(a)}function a(t){function e(e){var n=t.ncOptions.withInput.type,i=t.ncOptions.selected.indexOf(e);"radio"==n&&(t.ncOptions.selected=[]),-1!=i&&"radio"!=n?t.ncOptions.selected.splice(i,1):t.ncOptions.selected.push(e)}t.setSelect=e}return a.$inject=["$scope"],n.prototype.toggle=function(){return this.expanded()?(this.collapse(),this.toggleBtn.html(this.expander)):(this.expand(),this.toggleBtn.html(this.reducer)),this},n.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},n.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},n.prototype._hideChildren=function(){var t,e,n,i,s;for(i=this.children,s=[],e=0,n=i.length;n>e;e++)t=i[e],s.push(t.hide());return s},n.prototype._showChildren=function(){var t,e,n,i,s;for(i=this.children,s=[],e=0,n=i.length;n>e;e++)t=i[e],s.push(t.show());return s},n.prototype.collapsed=function(){return this.row.hasClass("collapsed")},n.prototype.parentNode=function(){return null!==this.parentId?this.tree[this.parentId]:null},n.prototype._initialize=function(){var t=this.settings;return this.render(),t.expandable===!0&&"collapsed"===t.initialState?this.collapse():this.expand(),this.initialized=!0},n.prototype._getParentId=function(t,e){var n=t.attr(e);return null!==n&&""!==n?n:void 0},n.prototype.render=function(){var t,n,i=this.settings,s=e.isEmptyObject(this.settings.withInput);return i.expandable===!0&&this.isBranchNode()&&(t=function(t){return!t.data.node.bgColor&&s&&(t.data.node.bgColor=t.data.node.row.css("background-color")),s&&(void 0!=t.data.node.tree.selected&&t.data.node.tree.selected.css("background",t.data.node.bgColor),t.data.node.tree.selected=t.data.node.row,t.data.node.row.css("background",i.selectedColor),t.data.node.settings.selected=[],t.data.node.settings.selected.push(t.data.node.id)),t.data.node.tree[e(this).parents("tr").attr(i.nodeIdAttr)].toggle(),t.preventDefault()},this.toggleBtn.html(this.expander),this.indenter.html(this.toggleBtn),n=i.clickableNodeNames===!0?this.treeCell:this.toggleBtn,function(e){n.off("click").on("click",{node:e},t)}(this)),this.indenter[0].style.paddingLeft=""+this.level()*i.indent+"px",this},n.prototype.isBranchNode=function(){return this.children.length>0||this.row.data(this.settings.branchAttr)===!0},n.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},n.prototype.ancestors=function(){var t,e;for(e=this,t=[];e=e.parentNode();)t.push(e);return t},n.prototype.level=function(){return this.ancestors().length},n.prototype.addChild=function(t){return this.children.push(t)},n.prototype.expanded=function(){return this.row.hasClass("expanded")},n.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this)},n.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),e(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this)},n.prototype.setChecked=function(){return this.row.find("input:first").prop("checked",!0),this},n.prototype.setUnChecke=function(){return this.row.find("input:first").prop("checked",!1),this},i.prototype.loadRows=function(t){var e,i,s;if(null!==t)for(s=0;s<t.length;s++)i=this._toJQueryDOM(t[s]),e=new n(i,this.tree,this.settings),this.nodes.push(e),this.tree[e.id]=e,null!==e.parentId&&this.tree[e.parentId]?this.tree[e.parentId].addChild(e):this.roots.push(e);for(s=0;s<this.nodes.length;s++)e=this.nodes[s].updateBranchLeafClass();return this},i.prototype._toJQueryDOM=function(t){var n,i,s,r=e("<tr></tr>"),o=this.settings.columNames.length,d=this.settings,a=this.settings.withInput;if(r.attr(d.nodeIdAttr,t.id),r.attr(d.parentIdAttr,t.parentId),a&&!e.isEmptyObject(a)){var h=e('<input type="'+a.type+'"/>');"radio"==a.type&&h.attr("name",a.name),function(t,e){h.on("click",{id:t.id,settings:e},function(t){var e=a.type,n=t.data.id,i=t.data.settings.selected.indexOf(n);"radio"==e&&(t.data.settings.selected=[]),-1!=i&&"radio"!=e?t.data.settings.selected.splice(i,1):t.data.settings.selected.push(n),console.info(t.data.settings.selected)})}(t,d),i=e("<td></td>"),i.append(h),i.width(a.width),r.append(i)}for(n=0;o>n;n++)s=d.columNames[n],t[s]&&(i=e("<td></td>"),i.html(t[s]),r.append(i));return r},i.prototype._toAngularDOM=function(t){var n,i,s=e("<tr></tr>"),r=e("<td></td>"),o=t.columNames.length;if(t.withInput&&!e.isEmptyObject(t.withInput)){var d=e("<input>"),a=t.withInput.type;d.attr("type",a),r.width(t.withInput.width),"radio"==a&&d.attr("name","radio"),d.attr("ng-click","setSelect(item.id)"),r.append(d),s.append(r)}for(s.attr("ng-repeat","item in ncData"),s.attr(t.nodeIdAttr,"{{item.id}}"),s.attr(t.parentIdAttr,"{{item.parentId}}"),i=0;o>i;i++)n=t.columNames[i],r=e("<td></td>"),r.attr("ng-bind","item."+n),s.append(r);return s},i.prototype.render=function(){var t,e,n,i;for(i=this.roots,e=0,n=i.length;n>e;e++)t=i[e],t.show();return this},{restrict:"EA",controller:a,scope:{ncOptions:"=",ncData:"="},link:d}}t.module("nc-treetable",[]).directive("ncTreeTable",n),n.$inject=["$compile"]}(window.angular,window.jQuery);